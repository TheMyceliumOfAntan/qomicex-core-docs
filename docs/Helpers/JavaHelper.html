<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>JavaHelper 详解 </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="JavaHelper 详解 ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/TheMyceliumOfAntan/Qomicex.Avalonia/blob/main/Qomicex.Docs/docs/Helpers/JavaHelper.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="javahelper-详解">JavaHelper 详解</h1>

<blockquote>
<p>用于搜索、验证和管理 Java 运行时环境的工具类。</p>
</blockquote>
<hr>
<h2 id="概述">概述</h2>
<p><code>JavaHelper</code> 是 Qomicex.Core 中用于管理 Java 运行时的核心工具类。它能够：</p>
<ul>
<li>自动搜索系统中已安装的 Java</li>
<li>验证 Java 版本是否满足要求</li>
<li>检测 Java 的架构和供应商信息</li>
<li>支持自定义搜索路径</li>
</ul>
<hr>
<h2 id="命名空间">命名空间</h2>
<pre><code class="lang-csharp">using Qomicex.Core.Modules.Helpers;
</code></pre>
<hr>
<h2 id="类定义">类定义</h2>
<pre><code class="lang-csharp">public class JavaHelper
{
    // 构造函数
    public JavaHelper();

    // 核心方法
    public Task&lt;List&lt;JavaInfo&gt;&gt; SearchJavaAsync(JavaSearchOptions options);
    public Task&lt;JavaValidationResult&gt; ValidateJavaAsync(string javaPath);
    public Task&lt;JavaInfo&gt; GetJavaInfoAsync(string javaPath);

    // 辅助方法
    public bool IsVersionCompatible(int majorVersion, string targetMinecraftVersion);
    public List&lt;string&gt; GetDefaultSearchPaths();
}
</code></pre>
<hr>
<h2 id="核心数据结构">核心数据结构</h2>
<h3 id="javainfo-类">JavaInfo 类</h3>
<p>表示一个 Java 安装的信息。</p>
<pre><code class="lang-csharp">public class JavaInfo
{
    public string Path { get; set; }                    // Java 可执行文件路径
    public string Version { get; set; }                 // 完整版本号（如 &quot;17.0.2&quot;）
    public int MajorVersion { get; set; }               // 主版本号（如 17）
    public int UpdateVersion { get; set; }              // 更新版本号（如 2）
    public string Architecture { get; set; }            // 架构（x64, x86, arm64）
    public string Vendor { get; set; }                  // 供应商
    public bool IsValid { get; set; }                   // 是否有效
    public JavaState State { get; set; }                // 状态
    public DateTime DetectedAt { get; set; }             // 检测时间
}
</code></pre>
<h3 id="javasearchoptions-类">JavaSearchOptions 类</h3>
<p>配置 Java 搜索选项。</p>
<pre><code class="lang-csharp">public class JavaSearchOptions
{
    public JavaSearchMode SearchMode { get; set; } = JavaSearchMode.Fast;
    public bool CheckValidity { get; set; } = true;
    public bool CheckVersion { get; set; } = true;
    public List&lt;string&gt; CustomPaths { get; set; } = new();
    public bool IncludeEnvironmentPath { get; set; } = true;
    public bool IncludeRegistry { get; set; } = true;
    public bool IncludeCommonPaths { get; set; } = true;
    public int TimeoutSeconds { get; set; } = 30;
    public int? MinMajorVersion { get; set; }
    public int? MaxMajorVersion { get; set; }
}
</code></pre>
<h3 id="javasearchmode-枚举">JavaSearchMode 枚举</h3>
<pre><code class="lang-csharp">public enum JavaSearchMode
{
    Fast,               // 快速模式 - 只搜索常见位置
    Thorough,           // 彻底模式 - 扫描整个系统
    EnvironmentOnly,    // 仅环境变量 - 只检查 PATH 中的 Java
    CustomPathsOnly     // 自定义路径 - 只在指定路径中搜索
}
</code></pre>
<h3 id="javastate-枚举">JavaState 枚举</h3>
<pre><code class="lang-csharp">public enum JavaState
{
    Valid,                  // 正常可用
    VersionTooLow,          // 版本过低
    VersionTooHigh,         // 版本过高
    ArchitectureMismatch,   // 架构不匹配
    Corrupted,              // 文件损坏或缺失
    PermissionDenied,       // 执行权限不足
    Unknown                 // 未知错误
}
</code></pre>
<hr>
<h2 id="核心方法详解">核心方法详解</h2>
<h3 id="searchjavaasync">SearchJavaAsync</h3>
<p>搜索系统中的 Java 安装。</p>
<h4 id="方法签名">方法签名</h4>
<pre><code class="lang-csharp">public async Task&lt;List&lt;JavaInfo&gt;&gt; SearchJavaAsync(JavaSearchOptions options)
</code></pre>
<h4 id="参数">参数</h4>
<table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>options</code></td>
<td><code>JavaSearchOptions</code></td>
<td>搜索选项配置</td>
</tr>
</tbody>
</table>
<h4 id="返回值">返回值</h4>
<p><code>Task&lt;List&lt;JavaInfo&gt;&gt;</code> - 找到的 Java 列表</p>
<h4 id="使用示例">使用示例</h4>
<pre><code class="lang-csharp">// 示例 1: 基本搜索
var javaHelper = new JavaHelper();
var javaList = await javaHelper.SearchJavaAsync(new JavaSearchOptions());

foreach (var java in javaList)
{
    Console.WriteLine($&quot;{java.Path} - {java.Version}&quot;);
}

// 示例 2: 快速模式（只搜索常见位置）
var fastOptions = new JavaSearchOptions
{
    SearchMode = JavaSearchMode.Fast,
    CheckVersion = true,
    CheckValidity = true
};

var fastResults = await javaHelper.SearchJavaAsync(fastOptions);

// 示例 3: 只搜索指定路径
var customOptions = new JavaSearchOptions
{
    SearchMode = JavaSearchMode.CustomPathsOnly,
    CustomPaths = new List&lt;string&gt;
    {
        @&quot;C:\Program Files\Java&quot;,
        @&quot;C:\Program Files\Eclipse Adoptium&quot;,
        @&quot;C:\Users\YourName\.jdks&quot;
    }
};

var customResults = await javaHelper.SearchJavaAsync(customOptions);

// 示例 4: 筛选特定版本范围的 Java
var filteredOptions = new JavaSearchOptions
{
    MinMajorVersion = 17,
    MaxMajorVersion = 21,
    CheckVersion = true
};

var filteredJava = await javaHelper.SearchJavaAsync(filteredOptions);

// 示例 5: 完整的生产环境示例
public async Task&lt;List&lt;JavaInfo&gt;&gt; FindSuitableJavaForMinecraft(string minecraftVersion)
{
    var helper = new JavaHelper();

    // 根据 Minecraft 版本确定需要的 Java 版本
    int minJavaVersion = minecraftVersion switch
    {
        var v when v.StartsWith(&quot;1.20&quot;) || v.StartsWith(&quot;1.21&quot;) =&gt; 17,
        var v when v.StartsWith(&quot;1.18&quot;) || v.StartsWith(&quot;1.19&quot;) =&gt; 17,
        var v when v.StartsWith(&quot;1.17&quot;) =&gt; 16,
        _ =&gt; 8
    };

    var options = new JavaSearchOptions
    {
        SearchMode = JavaSearchMode.Fast,
        CheckVersion = true,
        CheckValidity = true,
        MinMajorVersion = minJavaVersion,
        IncludeRegistry = true,
        IncludeEnvironmentPath = true,
        IncludeCommonPaths = true
    };

    var javaList = await helper.SearchJavaAsync(options);

    // 按版本排序，优先返回较新的 Java
    return javaList
        .Where(j =&gt; j.IsValid &amp;&amp; j.State == JavaState.Valid)
        .OrderByDescending(j =&gt; j.MajorVersion)
        .ThenByDescending(j =&gt; j.UpdateVersion)
        .ToList();
}

// 使用示例
var suitableJava = await FindSuitableJavaForMinecraft(&quot;1.20.1&quot;);
if (suitableJava.Any())
{
    Console.WriteLine($&quot;推荐使用: {suitableJava.First().Path}&quot;);
}
</code></pre>
<hr>
<h2 id="其他方法">其他方法</h2>
<h3 id="getjavainfoasync">GetJavaInfoAsync</h3>
<p>获取指定路径 Java 的详细信息。</p>
<pre><code class="lang-csharp">public async Task&lt;JavaInfo&gt; GetJavaInfoAsync(string javaPath)
</code></pre>
<h3 id="validatejavaasync">ValidateJavaAsync</h3>
<p>验证指定路径的 Java 是否有效。</p>
<pre><code class="lang-csharp">public async Task&lt;JavaValidationResult&gt; ValidateJavaAsync(string javaPath)
</code></pre>
<h3 id="isversioncompatible">IsVersionCompatible</h3>
<p>检查 Java 版本是否与目标 Minecraft 版本兼容。</p>
<pre><code class="lang-csharp">public bool IsVersionCompatible(int majorVersion, string targetMinecraftVersion)
</code></pre>
<hr>
<h2 id="总结">总结</h2>
<p>JavaHelper 提供了完整的 Java 管理功能：</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>自动搜索</td>
<td>在系统中自动查找已安装的 Java</td>
</tr>
<tr>
<td>版本检测</td>
<td>获取 Java 的详细版本信息</td>
</tr>
<tr>
<td>有效性验证</td>
<td>检查 Java 是否可用</td>
</tr>
<tr>
<td>兼容性检查</td>
<td>根据 Minecraft 版本推荐合适的 Java</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="下一步">下一步</h2>
<ul>
<li><a href="GeneralHelper.md">GeneralHelper 详解</a> - 通用工具方法</li>
<li><a href="../SystemInfo/README.md">系统信息详解</a> - 获取系统硬件信息</li>
</ul>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/TheMyceliumOfAntan/Qomicex.Avalonia/blob/main/Qomicex.Docs/docs/Helpers/JavaHelper.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
