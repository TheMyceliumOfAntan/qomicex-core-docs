<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Forge 安装器 (ForgeInstaller) </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Forge 安装器 (ForgeInstaller) ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/TheMyceliumOfAntan/Qomicex.Avalonia/blob/main/Qomicex.Docs/docs/Installers/ForgeInstaller.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="forge-安装器-forgeinstaller">Forge 安装器 (ForgeInstaller)</h1>

<blockquote>
<p>用于安装 Minecraft Forge Mod 加载器的安装器。</p>
</blockquote>
<hr>
<h2 id="概述">概述</h2>
<p><code>ForgeInstaller</code> 是 Qomicex.Core 提供的 Forge Mod 加载器安装器。它支持从 Minecraft 1.6.4 到最新版本的全系列 Forge 安装，能够自动处理不同版本的安装逻辑、库文件下载、处理器执行等复杂流程。</p>
<h3 id="支持的版本">支持的版本</h3>
<table>
<thead>
<tr>
<th>版本范围</th>
<th>安装方式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.17+</td>
<td>新版安装器</td>
<td>使用新版的 install_profile.json</td>
</tr>
<tr>
<td>1.13 - 1.16.5</td>
<td>过渡版安装器</td>
<td>混合新旧格式</td>
</tr>
<tr>
<td>1.6.4 - 1.12.2</td>
<td>旧版安装器</td>
<td>使用旧版安装格式（自动降级处理）</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="命名空间">命名空间</h2>
<pre><code class="lang-csharp">using Qomicex.Core.Modules.Helpers.Installers;
</code></pre>
<hr>
<h2 id="构造函数">构造函数</h2>
<pre><code class="lang-csharp">public ForgeInstaller(int sourceId, string gameDir, string gameVersion)
</code></pre>
<p><strong>参数：</strong>
| 参数名 | 类型 | 说明 |
|--------|------|------|
| <code>sourceId</code> | <code>int</code> | 下载源（0=官方，1=BMCLAPI） |
| <code>gameDir</code> | <code>string</code> | 游戏目录（.minecraft 文件夹路径） |
| <code>gameVersion</code> | <code>string</code> | 基础 Minecraft 版本（如 &quot;1.20.1&quot;） |</p>
<p><strong>示例：</strong></p>
<pre><code class="lang-csharp">var installer = new ForgeInstaller(
    sourceId: 1,  // 使用 BMCLAPI 加速
    gameDir: @&quot;C:\Minecraft\.minecraft&quot;,
    gameVersion: &quot;1.20.1&quot;
);
</code></pre>
<hr>
<h2 id="主要方法">主要方法</h2>
<h3 id="installasync">InstallAsync</h3>
<p>异步安装 Forge。</p>
<pre><code class="lang-csharp">public async void InstallAsync(
    string versionId,
    string inheritsFromJson,
    string? javaPath,
    string? forgeInstallerPath,
    string? para3,
    string? para4
)
</code></pre>
<p><strong>参数：</strong>
| 参数名 | 类型 | 说明 |
|--------|------|------|
| <code>versionId</code> | <code>string</code> | 生成的版本 ID（如 &quot;1.20.1-forge-47.0.0&quot;） |
| <code>inheritsFromJson</code> | <code>string</code> | 继承自的原版版本 JSON 内容（可为空） |
| <code>javaPath</code> | <code>string?</code> | Java 可执行文件路径（第1参数） |
| <code>forgeInstallerPath</code> | <code>string?</code> | Forge 安装器 jar 文件路径（第2参数） |
| <code>para3</code> | <code>string?</code> | 保留参数（未使用） |
| <code>para4</code> | <code>string?</code> | 保留参数（未使用） |</p>
<p><strong>完整安装示例：</strong></p>
<pre><code class="lang-csharp">var installer = new ForgeInstaller(1, @&quot;C:\Minecraft\.minecraft&quot;, &quot;1.20.1&quot;);

// 执行安装
installer.InstallAsync(
    versionId: &quot;1.20.1-forge-47.0.0&quot;,
    inheritsFromJson: null,  // 可选：原版版本 JSON
    javaPath: @&quot;C:\Program Files\Java\jdk-17\bin\java.exe&quot;,
    forgeInstallerPath: @&quot;C:\Downloads\forge-1.20.1-47.0.0-installer.jar&quot;,
    para3: null,
    para4: null
);
</code></pre>
<hr>
<h3 id="islegacyforgeinstaller">IsLegacyForgeInstaller</h3>
<p>检查是否是旧版 Forge 安装器（1.12.2 及以下版本）。</p>
<pre><code class="lang-csharp">public bool IsLegacyForgeInstaller(string forgeInstallerPath)
</code></pre>
<p><strong>参数：</strong>
| 参数名 | 类型 | 说明 |
|--------|------|------|
| <code>forgeInstallerPath</code> | <code>string</code> | Forge 安装器 jar 文件路径 |</p>
<p><strong>返回值：</strong> <code>bool</code> - 是否是旧版安装器</p>
<hr>
<h3 id="getmissforgelibraries">GetMissForgeLibraries</h3>
<p>获取缺失的 Forge 库文件列表。</p>
<pre><code class="lang-csharp">public List&lt;LocalResourceHelper.MissFileData&gt; GetMissForgeLibraries(
    string forgeInstallerPath,
    string versionId
)
</code></pre>
<p><strong>参数：</strong>
| 参数名 | 类型 | 说明 |
|--------|------|------|
| <code>forgeInstallerPath</code> | <code>string</code> | Forge 安装器 jar 文件路径 |
| <code>versionId</code> | <code>string</code> | 版本 ID |</p>
<p><strong>返回值：</strong> <code>List&lt;LocalResourceHelper.MissFileData&gt;</code> - 缺失的库文件列表</p>
<hr>
<h2 id="安装流程详解">安装流程详解</h2>
<h3 id="新版-forge-安装流程113">新版 Forge 安装流程（1.13+）</h3>
<pre><code>1. 读取安装器
   ├── 解压 version.json
   ├── 解压 install_profile.json
   └── 解压 client.lzma

2. 生成版本配置
   ├── 修改 version.json 的 id 和 inheritsFrom
   ├── 合并原版版本 JSON（如果有）
   └── 写出版本 JSON 文件

3. 解压客户端 LZMA
   └── 写出 client.lzma 到 libraries

4. 解压 Forge 主 Jar
   └── 写出到 libraries/maven 路径

5. 下载缺失的库文件
   ├── 解析 install_profile.json 的 libraries
   └── 下载缺失的 jar 到 libraries

6. 执行 Processor 后处理
   ├── 解析 install_profile.json 的 processors
   ├── 下载 processor 所需的工具
   └── 执行每个 processor（包括客户端处理）

7. 完成安装
</code></pre>
<h3 id="旧版-forge-安装流程1122-">旧版 Forge 安装流程（1.12.2-）</h3>
<p>旧版 Forge 使用不同的安装格式，主要区别：</p>
<ul>
<li>使用 <code>install.py</code> 或 <code>forge-installer.jar</code> 直接安装</li>
<li>不依赖复杂的 processor 系统</li>
<li>直接复制库文件和修改 JSON</li>
</ul>
<hr>
<h2 id="完整安装示例">完整安装示例</h2>
<h3 id="完整安装流程示例">完整安装流程示例</h3>
<pre><code class="lang-csharp">using Qomicex.Core.Modules.Helpers.Installers;
using Qomicex.Core.Modules.Helpers.Resources;
using System.Diagnostics;

public async Task InstallForgeExample()
{
    // 1. 配置参数
    string gameDir = @&quot;C:\Minecraft\.minecraft&quot;;
    string gameVersion = &quot;1.20.1&quot;;
    string forgeVersion = &quot;47.0.0&quot;;
    string javaPath = @&quot;C:\Program Files\Java\jdk-17\bin\java.exe&quot;;

    // 2. 下载 Forge 安装器（需要先获取下载地址）
    var modLoaderHelper = new ModLoaderResourceHelper(1);
    var forgeVersions = await modLoaderHelper.GetForgeVersions(gameVersion);
    var targetForge = forgeVersions.FirstOrDefault(v =&gt; v.Version == forgeVersion);

    if (targetForge == null)
    {
        throw new Exception($&quot;未找到 Forge {forgeVersion} 版本&quot;);
    }

    // 3. 下载安装器
    string installerPath = Path.Combine(Path.GetTempPath(), $&quot;forge-{gameVersion}-{forgeVersion}-installer.jar&quot;);
    using (var http = new HttpClient())
    {
        var data = await http.GetByteArrayAsync(targetForge.DownloadUrl);
        await File.WriteAllBytesAsync(installerPath, data);
    }
    Console.WriteLine($&quot;Forge 安装器已下载到: {installerPath}&quot;);

    // 4. 创建安装器实例
    var installer = new ForgeInstaller(
        sourceId: 1,  // BMCLAPI
        gameDir: gameDir,
        gameVersion: gameVersion
    );

    // 5. 检查是否是旧版安装器
    bool isLegacy = installer.IsLegacyForgeInstaller(installerPath);
    Console.WriteLine($&quot;Forge 版本类型: {(isLegacy ? &quot;旧版 (&lt;= 1.12.2)&quot; : &quot;新版 (&gt;= 1.13)&quot;)}&quot;);

    // 6. 执行安装
    string versionId = $&quot;{gameVersion}-forge-{forgeVersion}&quot;;

    try
    {
        Console.WriteLine(&quot;开始安装 Forge...&quot;);
        installer.InstallAsync(
            versionId: versionId,
            inheritsFromJson: null,
            javaPath: javaPath,
            forgeInstallerPath: installerPath,
            para3: null,
            para4: null
        );

        // 注意：InstallAsync 是 void 方法，实际安装是异步执行的
        // 等待一段时间让安装完成（实际应用中应该使用事件或回调）
        Console.WriteLine(&quot;Forge 安装已启动，请等待安装完成...&quot;);

        // 检查安装结果
        string versionJsonPath = Path.Combine(gameDir, &quot;versions&quot;, versionId, $&quot;{versionId}.json&quot;);
        int waitTime = 0;
        while (!File.Exists(versionJsonPath) &amp;&amp; waitTime &lt; 120)  // 最多等待120秒
        {
            await Task.Delay(1000);
            waitTime++;
            Console.WriteLine($&quot;等待安装完成... ({waitTime}s)&quot;);
        }

        if (File.Exists(versionJsonPath))
        {
            Console.WriteLine($&quot;✓ Forge 安装成功！&quot;);
            Console.WriteLine($&quot;  版本: {versionId}&quot;);
            Console.WriteLine($&quot;  路径: {versionJsonPath}&quot;);
        }
        else
        {
            Console.WriteLine($&quot;✗ Forge 安装可能失败，未找到版本文件&quot;);
        }
    }
    catch (Exception ex)
    {
        Console.WriteLine($&quot;✗ Forge 安装失败: {ex.Message}&quot;);
        Console.WriteLine($&quot;详细错误: {ex.StackTrace}&quot;);
    }
    finally
    {
        // 清理临时文件
        if (File.Exists(installerPath))
        {
            File.Delete(installerPath);
            Console.WriteLine($&quot;已清理临时安装器文件&quot;);
        }
    }
}
</code></pre>
<hr>
<h2 id="注意事项">注意事项</h2>
<h3 id="1-安装器来源">1. 安装器来源</h3>
<ul>
<li>请确保从官方或可信来源下载 Forge 安装器</li>
<li>验证安装器的 SHA1 哈希值（如果可用）</li>
</ul>
<h3 id="2-java-版本">2. Java 版本</h3>
<ul>
<li>不同 Minecraft 版本需要不同的 Java 版本</li>
<li>1.17+ 需要 Java 17+</li>
<li>1.16.5 及以下通常需要 Java 8</li>
</ul>
<h3 id="3-网络问题">3. 网络问题</h3>
<ul>
<li>安装过程需要下载大量库文件</li>
<li>建议使用国内镜像源（如 BMCLAPI）加速下载</li>
<li>如果下载失败，可以重试或手动下载缺失的库文件</li>
</ul>
<h3 id="4-旧版安装器">4. 旧版安装器</h3>
<ul>
<li>1.12.2 及以下的 Forge 使用旧版安装格式</li>
<li><code>IsLegacyForgeInstaller</code> 方法可以检测安装器类型</li>
<li>旧版安装流程相对简单，不需要执行 Processor</li>
</ul>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/TheMyceliumOfAntan/Qomicex.Avalonia/blob/main/Qomicex.Docs/docs/Installers/ForgeInstaller.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
