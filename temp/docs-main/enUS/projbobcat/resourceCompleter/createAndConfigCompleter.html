<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Create and configure completers | Qomicex.Core API文档 </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Create and configure completers | Qomicex.Core API文档 ">
      
      
      <link rel="icon" href="../../../../../favicon.ico">
      <link rel="stylesheet" href="../../../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../../../public/main.css">
      <meta name="docfx:navrel" content="../../../../../toc.html">
      <meta name="docfx:tocrel" content="../../../../../toc.html">
      
      <meta name="docfx:rel" content="../../../../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/TheMyceliumOfAntan/Qomicex.Avalonia/blob/main/Qomicex.Docs/temp/docs-main/enUS/projbobcat/resourceCompleter/createAndConfigCompleter.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../../../index.html">
            <img id="logo" class="svg" src="../../../../../logo.svg" alt="Qomicex.Core">
            Qomicex.Core
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="create-and-configure-completers">Create and configure completers</h1>

<p>[[toc]]</p>
<h2 id="initialize-the-completer">Initialize the completer</h2>
<p>The method of creating a resource completer is very simple. You only need to use the following code to complete the initialization of the completer:</p>
<pre><code class="lang-c#">
var completer = new DefaultResourceCompleter
{
    MaxDegreeOfParallelism = [MAX_DEGREE_OF_PARALLELISM],
    ResourceInfoResolvers = new List&lt;IResourceInfoResolver&gt;
    {
        ... // Initialization of resource information resolvers
    },
    TotalRetry = [NUMBER_OF_TOTAL_RETRY],
    CheckFile = [CHECK_FILE_AFTER_DOWNLOADED],
    DownloadParts = [TOTAL_DOWNLOAD_SEGMENTS_FOR_LARGE_FILE]
};

</code></pre>
<p>::: tip</p>
<p>For tutorials on the initialization of the resource information resolver, please refer to the chapter <a href="/enUS/projbobcat/resourceCompleter/resourceInfoResolver/index">Resource Information Resolver</a>
:::</p>
<p>In the above code block, please replace these parameters according to your actual situation:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Project</th>
<th style="text-align: left;">Data Type</th>
<th style="text-align: center;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">[MAX_DEGREE_OF_PARALLELISM]</td>
<td style="text-align: left;">INT</td>
<td style="text-align: center;">Resource check parallelism (check the number of game resources at the same time)</td>
</tr>
<tr>
<td style="text-align: center;">[CHECK_FILE_AFTER_DOWNLOADED]</td>
<td style="text-align: left;">BOOLEAN</td>
<td style="text-align: center;">Check file integrity after file download is complete (if resource checksum exists)</td>
</tr>
<tr>
<td style="text-align: center;">[TOTAL_DOWNLOAD_SEGMENTS_FOR_LARGE_FILE]</td>
<td style="text-align: left;">INT</td>
<td style="text-align: center;">Number of fragments when downloading large files</td>
</tr>
</tbody>
</table>
<p>::: warning</p>
<p><strong>[MAX_DEGREE_OF_PARALLELISM]</strong> and <strong>[TOTAL_DOWNLOAD_SEGMENTS_FOR_LARGE_FILE]</strong>
Please adjust the value according to the hardware performance as appropriate. Setting a value that is too large may cause a decrease in throughput.</p>
<p>:::</p>
<h2 id="complete-game-resources">Complete game resources</h2>
<p>After initializing the resource completer, you only need to call the completion method to start checking and completing operations:</p>
<p>In an asynchronous context, use <strong>CheckAndDownloadTaskAsync</strong> to complete the installation:</p>
<pre><code class="lang-c#">
var result = await completer.CheckAndDownloadTaskAsync(); // [!code focus]

if (result.TaskStatus == TaskResultStatus.Error &amp;&amp; (result.Value?.IsLibDownloadFailed ?? false))
{
     // After completing the completion, the resource inspector will return the execution results.
     // You can check the property value in result to determine whether completion is complete
    
     // IsLibDownloadFailed will reflect whether the library files necessary for startup have been successfully completed.
     // Generally speaking, if the completion of the library file fails, it is likely to cause the game to fail to start.
}

</code></pre>
<p>In a sync context, use <strong>CheckAndDownload</strong> to complete the installation:</p>
<pre><code class="lang-c#">
var result = completer.CheckAndDownload(); // [!code focus]

</code></pre>
<h2 id="report-progress">Report progress</h2>
<p>In some cases, the resource completer may take several minutes to complete checking and downloading the resource.
Therefore, you may need to report the completer's current progress to the user in real time.</p>
<h3 id="report-resource-inspector-progress">Report Resource Inspector progress</h3>
<p>You can get real-time check progress by registering the event <strong>GameResourceInfoResolveStatus</strong>:</p>
<pre><code class="lang-c#">
completer.GameResourceInfoResolveStatus += (_, args) =&gt; 
    { ReportProgress(args.Progress, args.Status); };

</code></pre>
<p>Among them, <strong>args.Progress</strong> indicates the current percentage progress of the checker. <strong>args.Status</strong> is a text description of the current progress of the checker.</p>
<h3 id="report-completion-file-download-progress">Report completion file download progress</h3>
<p>You can get real-time check progress by registering the event <strong>DownloadFileCompletedEvent</strong>:</p>
<pre><code class="lang-c#">
completer.DownloadFileCompletedEvent += (sender, args) =&gt;
{
     // The sender parameter is the last successfully downloaded file of the completer, the type is DownloadFile
     // args returns the download status of the file (success/failure), and the retry count of the file,
     // Type is DownloadFileCompletedEventArgs
};

</code></pre>
<p>::: tip</p>
<ul>
<li><a href="https://github.com/Corona-Studio/ProjBobcat/blob/master/ProjBobcat/ProjBobcat/Class/Model/DownloadFile.cs">DownloadFile Class Structure</a></li>
<li><a href="https://github.com/Corona-Studio/ProjBobcat/blob/master/ProjBobcat/ProjBobcat/Event/DownloadFileCompletedEventArgs.cs">DownloadFileCompletedEventArgs Event Structure</a></li>
</ul>
<p>:::</p>
<h3 id="report-progress-information-for-files-being-downloaded">Report progress information for files being downloaded</h3>
<p>You can get real-time check progress by registering the event <strong>DownloadFileChangedEvent</strong>:</p>
<pre><code class="lang-c#">
rC.DownloadFileChangedEvent += (_, args) =&gt;
{
    // args returns the specific information of the file being downloaded (number of bytes received, total number of bytes, current speed, percentage progress)
     // Type is DownloadFileChangedEventArgs
};

</code></pre>
<p>::: tip</p>
<ul>
<li><a href="https://github.com/Corona-Studio/ProjBobcat/blob/master/ProjBobcat/ProjBobcat/Event/DownloadFileChangedEventArgs.cs">DownloadFileChangedEventArgs Event Structure</a></li>
</ul>
<p>:::</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/TheMyceliumOfAntan/Qomicex.Avalonia/blob/main/Qomicex.Docs/temp/docs-main/enUS/projbobcat/resourceCompleter/createAndConfigCompleter.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          Qomicex.Avalonia
        </div>
      </div>
    </footer>
  </body>
</html>
